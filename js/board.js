// Generated by CoffeeScript 2.5.1
var SIZE,
  modulo = function(a, b) { return (+a % (b = +b) + b) % b; },
  indexOf = [].indexOf;

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  lerp,
  param,
  range,
  hexToBase64
} from '../js/utils.js';

import cryptoJs from 'https://cdn.skypack.dev/crypto-js';

import {
  Square
} from '../js/square.js';

import {
  Button
} from '../js/button.js';

import {
  coords,
  clickString,
  getMove,
  global,
  loadTree,
  toObjectNotation,
  toUCI
} from '../js/globals.js';

import {
  dumpState
} from '../js/globals.js';

SIZE = global.SIZE;

export var Board = (function() {
  var calcBar;

  class Board {
    constructor() {
      var i, k, len, ref, x0, x1, x2, x3;
      this.click = this.click.bind(this);
      // g√• igenom nodens barn och visa dem i en sorterad lista
      this.showChildren = this.showChildren.bind(this);
      this.draw = this.draw.bind(this);
      this.littera = this.littera.bind(this);
      this.flip = this.flip.bind(this);
      this.squares = [];
      this.clickedSquares = [];
      this.pieces = "";
      this.flipped = false;
      ref = range(64);
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        ((i) => {
          return this.squares.push(new Square(i, () => {
            return this.click(i);
          }));
        })(i);
      }
      this.buttons = [];
      x0 = 1.5;
      x1 = 3.5;
      x2 = 5.5;
      x3 = 7.5;
      this.buttons.push(new Button(x0 * SIZE, 9.5 * SIZE, 'undo', () => {
        return clickString('undo');
      }));
      this.buttons.push(new Button(x0 * SIZE, 10.5 * SIZE, 'flip', () => {
        return clickString('flip');
      }));
      this.buttons.push(new Button(x3 * SIZE, 10.5 * SIZE, 'link', () => {
        return clickString('link');
      }));
    }

    click(i) {
      var col, color, move, row, sq, uci;
      col = modulo(i, 8);
      row = 7 - Math.floor(i / 8);
      sq = global.chess.board()[row][col];
      color = "wb"[modulo(global.chess.history().length, 2)];
      if (this.clickedSquares.length === 0) {
        if (sq === null) {
          return;
        }
        if (sq.color === color) {
          return this.clickedSquares.push(i);
        }
      } else {
        if (i === this.clickedSquares[0]) {
          this.clickedSquares = [];
          return;
        }
        this.clickedSquares.push(i);
        move = toObjectNotation(this.clickedSquares);
        uci = toUCI(this.clickedSquares);
        if (global.chess.move(move)) { // accepera draget
          global.stack.push(global.currNode);
          if (indexOf.call(global.currNode, uci) < 0) {
            global.currNode[uci] = {};
          }
          global.currNode = global.currNode[uci];
        }
        return this.clickedSquares = [];
      }
    }

    showChildren() {
      var base64, fen, i, k, key, keys, len, pair, ref, san, value;
      keys = _.keys(global.currNode);
      push();
      noStroke();
      textAlign(LEFT, CENTER);
      fill('white');
      ref = range(keys.length);
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        key = keys[i];
        pair = coords(key);
        global.chess.move(toObjectNotation(pair));
        fen = global.chess.fen();
        // console.log key,pair,toObjectNotation pair
        //san = global.chess.san toObjectNotation pair
        san = _.last(global.chess.history());
        base64 = hexToBase64(cryptoJs.SHA256(fen).toString()).slice(0, 8);
        value = global.database[base64] || "?";
        // console.log key, san, base64, value, fen
        text(san + ": " + value, 8.7 * SIZE, 1 * SIZE + i * 0.5 * SIZE);
        global.chess.undo();
      }
      return pop();
    }

    draw() {
      var button, i, j, k, l, len, len1, len2, m, piece, ref, ref1, ref2, score;
      ref = this.buttons;
      for (k = 0, len = ref.length; k < len; k++) {
        button = ref[k];
        button.draw();
      }
      if (!global.tree) {
        return;
      }
      fill('white');
      textSize(SIZE * 0.3);
      push();
      textAlign(LEFT, CENTER);
      text(global.trees[0].name, 0.05 * SIZE, 0.3 * SIZE);
      pop();
      ref1 = range(8);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        i = ref1[l];
        ref2 = range(8);
        for (m = 0, len2 = ref2.length; m < len2; m++) {
          j = ref2[m];
          piece = global.chess.board()[7 - i][j];
          this.squares[i * 8 + j].draw(piece, this.flipped, i * 8 + j === this.clickedSquares[0]);
        }
      }
      stroke('black');
      noFill();
      rect(SIZE * 4.5, SIZE * 4.5, SIZE * 8, SIZE * 8);
      this.littera();
      push();
      textAlign(CENTER, CENTER);
      if (global.index > 0) {
        text('move: ' + (1 + Math.floor(global.index / 2)) + "BW"[global.index % 2] + " of " + (1 + Math.floor(global.moves.length / 2)), 4.5 * SIZE, 10 * SIZE);
      }
      if (global.index === 0) {
        score = '0';
      }
      text(global.version, 7.5 * SIZE, 10 * SIZE);
      textAlign(RIGHT, CENTER);
      fill('white');
      text(score, 10.1 * SIZE, 0.3 * SIZE);
      pop();
      this.drawBars(score);
      return this.showChildren();
    }

    littera() {
      var digits, i, k, len, letters, ref, results;
      noStroke();
      fill('black');
      textSize(SIZE * 0.3);
      letters = this.flipped ? "hgfedcba" : "abcdefgh";
      digits = this.flipped ? "12345678" : "87654321";
      ref = range(8);
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        text(letters[i], SIZE * (i + 1), SIZE * 8.8);
        results.push(text(digits[i], SIZE * 0.15, SIZE * (i + 1)));
      }
      return results;
    }

    flip() {
      return this.flipped = !this.flipped;
    }

    drawBars(score) {
      var h, w, x;
      param.String(score);
      stroke('black');
      h = calcBar(score);
      push();
      if (this.flipped) {
        translate(0, SIZE * 9);
        scale(1, -1);
      }
      rectMode(CORNER);
      noStroke();
      x = 0.35 * SIZE;
      w = 0.10 * SIZE;
      fill('black');
      rect(x, 0.5 * SIZE, w, SIZE * 4);
      fill('white');
      rect(x, 4.5 * SIZE, w, SIZE * 4);
      if (h > 0) {
        fill('white');
        rect(x, 4.5 * SIZE - h, w, h);
      } else {
        fill('black');
        rect(x, 4.5 * SIZE, w, -h);
      }
      return pop();
    }

  };

  calcBar = (score) => {
    var LIMIT, d, res;
    param.String(score);
    LIMIT = 2000;
    if (score[0] === '#') {
      d = LIMIT;
    } else {
      d = Math.abs(score);
    }
    if (d > LIMIT) {
      d = LIMIT;
    }
    res = lerp(0, 4 * SIZE, d / LIMIT);
    if (indexOf.call(score, "-") >= 0) {
      res = -res;
    }
    return param.Integer(Math.round(res));
  };

  ass(4 * SIZE, calcBar("2100"));

  ass(4 * SIZE, calcBar("2000"));

  ass(2 * SIZE, calcBar("1000"));

  ass(SIZE, calcBar("500"));

  ass(0, calcBar("1"));

  ass(-SIZE, calcBar("-500"));

  ass(-4 * SIZE, calcBar("#-1"));

  return Board;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcYm9hcmQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLElBQUE7RUFBQTs7O0FBQUEsT0FBTyxDQUFQLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLEdBQVI7RUFBWSxJQUFaO0VBQWlCLEtBQWpCO0VBQXVCLEtBQXZCO0VBQTZCLFdBQTdCO0NBQUEsTUFBQTs7QUFDQSxPQUFPLFFBQVAsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxNQUFSO0VBQWUsV0FBZjtFQUEyQixPQUEzQjtFQUFtQyxNQUFuQztFQUEwQyxRQUExQztFQUFtRCxnQkFBbkQ7RUFBb0UsS0FBcEU7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxTQUFSO0NBQUEsTUFBQTs7QUFFQSxJQUFBLEdBQU8sTUFBTSxDQUFDOztBQUVkLE9BQUEsSUFBYTs7O0VBQU4sTUFBQSxNQUFBO0lBQ04sV0FBYSxDQUFBLENBQUE7QUFDZCxVQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQTtVQWdCQyxDQUFBLFlBQUEsQ0FBQSxpQkFoQkQ7O1VBdUNDLENBQUEsbUJBQUEsQ0FBQTtVQXFCQSxDQUFBLFdBQUEsQ0FBQTtVQTBDQSxDQUFBLGNBQUEsQ0FBQTtVQVdBLENBQUEsV0FBQSxDQUFBO01BakhDLElBQUMsQ0FBQSxPQUFELEdBQVc7TUFDWCxJQUFDLENBQUEsY0FBRCxHQUFrQjtNQUNsQixJQUFDLENBQUEsTUFBRCxHQUFVO01BQ1YsSUFBQyxDQUFBLE9BQUQsR0FBVztBQUNYO01BQUEsS0FBQSxxQ0FBQTs7UUFDSSxDQUFBLENBQUMsQ0FBRCxDQUFBLEdBQUE7aUJBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFU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OlsiaW1wb3J0IF8gICAgICAgICAgIGZyb20gJ2h0dHBzOi8vY2RuLnNreXBhY2suZGV2L2xvZGFzaCdcclxuaW1wb3J0IHthc3MsbGVycCxwYXJhbSxyYW5nZSxoZXhUb0Jhc2U2NH0gZnJvbSAnLi4vanMvdXRpbHMuanMnXHJcbmltcG9ydCBjcnlwdG9KcyBmcm9tICdodHRwczovL2Nkbi5za3lwYWNrLmRldi9jcnlwdG8tanMnXHJcbmltcG9ydCB7U3F1YXJlfSBmcm9tICcuLi9qcy9zcXVhcmUuanMnXHJcbmltcG9ydCB7QnV0dG9ufSBmcm9tICcuLi9qcy9idXR0b24uanMnXHJcbmltcG9ydCB7Y29vcmRzLGNsaWNrU3RyaW5nLGdldE1vdmUsZ2xvYmFsLGxvYWRUcmVlLHRvT2JqZWN0Tm90YXRpb24sdG9VQ0l9IGZyb20gJy4uL2pzL2dsb2JhbHMuanMnXHJcbmltcG9ydCB7ZHVtcFN0YXRlfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5cclxuU0laRSA9IGdsb2JhbC5TSVpFXHJcblxyXG5leHBvcnQgY2xhc3MgQm9hcmRcclxuXHRjb25zdHJ1Y3RvcjogLT5cclxuXHRcdEBzcXVhcmVzID0gW11cclxuXHRcdEBjbGlja2VkU3F1YXJlcyA9IFtdXHJcblx0XHRAcGllY2VzID0gXCJcIlxyXG5cdFx0QGZsaXBwZWQgPSBmYWxzZVxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgNjRcclxuXHRcdFx0ZG8gKGkpID0+IEBzcXVhcmVzLnB1c2ggbmV3IFNxdWFyZSBpLCA9PiBAY2xpY2sgaVxyXG5cclxuXHRcdEBidXR0b25zID0gW11cclxuXHRcdHgwID0gMS41XHJcblx0XHR4MSA9IDMuNVxyXG5cdFx0eDIgPSA1LjVcclxuXHRcdHgzID0gNy41XHJcblx0XHRAYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24geDAqU0laRSwgOS41KlNJWkUsICd1bmRvJywgICAgPT4gY2xpY2tTdHJpbmcgJ3VuZG8nXHJcblx0XHRAYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24geDAqU0laRSwgMTAuNSpTSVpFLCAnZmxpcCcsICAgID0+IGNsaWNrU3RyaW5nICdmbGlwJ1xyXG5cdFx0QGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uIHgzKlNJWkUsIDEwLjUqU0laRSwgJ2xpbmsnLCAgICA9PiBjbGlja1N0cmluZyAnbGluaydcclxuXHJcblx0Y2xpY2sgOiAoaSkgPT5cclxuXHRcdGNvbCA9IGkgJSUgOFxyXG5cdFx0cm93ID0gNy1pIC8vIDhcclxuXHRcdHNxID0gZ2xvYmFsLmNoZXNzLmJvYXJkKClbcm93XVtjb2xdXHJcblx0XHRjb2xvciA9IFwid2JcIltnbG9iYWwuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyXSAjIGbDtnJ2w6RudGFkIGbDpHJnIHDDpSBwasOkc2VuXHJcblxyXG5cdFx0aWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCA9PSAwXHJcblx0XHRcdGlmIHNxID09IG51bGwgdGhlbiByZXR1cm5cclxuXHRcdFx0aWYgc3EuY29sb3IgPT0gY29sb3IgdGhlbiBAY2xpY2tlZFNxdWFyZXMucHVzaCBpXHJcblx0XHRlbHNlXHJcblx0XHRcdGlmIGkgPT0gQGNsaWNrZWRTcXVhcmVzWzBdXHJcblx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdFx0XHRyZXR1cm5cclxuXHRcdFx0QGNsaWNrZWRTcXVhcmVzLnB1c2ggaVxyXG5cdFx0XHRtb3ZlID0gdG9PYmplY3ROb3RhdGlvbiBAY2xpY2tlZFNxdWFyZXNcclxuXHRcdFx0dWNpID0gdG9VQ0kgQGNsaWNrZWRTcXVhcmVzXHJcblx0XHRcdGlmIGdsb2JhbC5jaGVzcy5tb3ZlIG1vdmUgIyBhY2NlcGVyYSBkcmFnZXRcclxuXHRcdFx0XHRnbG9iYWwuc3RhY2sucHVzaCBnbG9iYWwuY3Vyck5vZGVcclxuXHRcdFx0XHRpZiB1Y2kgbm90IGluIGdsb2JhbC5jdXJyTm9kZSB0aGVuIGdsb2JhbC5jdXJyTm9kZVt1Y2ldID0ge31cclxuXHRcdFx0XHRnbG9iYWwuY3Vyck5vZGUgPSBnbG9iYWwuY3Vyck5vZGVbdWNpXVxyXG5cdFx0XHRAY2xpY2tlZFNxdWFyZXMgPSBbXVxyXG5cclxuIyBnw6UgaWdlbm9tIG5vZGVucyBiYXJuIG9jaCB2aXNhIGRlbSBpIGVuIHNvcnRlcmFkIGxpc3RhXHJcblx0c2hvd0NoaWxkcmVuIDogPT5cclxuXHRcdGtleXMgPSBfLmtleXMgZ2xvYmFsLmN1cnJOb2RlXHJcblx0XHRwdXNoKClcclxuXHRcdG5vU3Ryb2tlKClcclxuXHRcdHRleHRBbGlnbiBMRUZULENFTlRFUlxyXG5cdFx0ZmlsbCAnd2hpdGUnXHJcblx0XHRmb3IgaSBpbiByYW5nZSBrZXlzLmxlbmd0aFxyXG5cdFx0XHRrZXkgPSBrZXlzW2ldXHJcblx0XHRcdHBhaXIgPSBjb29yZHMga2V5XHJcblx0XHRcdGdsb2JhbC5jaGVzcy5tb3ZlIHRvT2JqZWN0Tm90YXRpb24gcGFpclxyXG5cdFx0XHRmZW4gPSBnbG9iYWwuY2hlc3MuZmVuKClcclxuXHRcdFx0IyBjb25zb2xlLmxvZyBrZXkscGFpcix0b09iamVjdE5vdGF0aW9uIHBhaXJcclxuXHRcdFx0I3NhbiA9IGdsb2JhbC5jaGVzcy5zYW4gdG9PYmplY3ROb3RhdGlvbiBwYWlyXHJcblx0XHRcdHNhbiA9IF8ubGFzdCBnbG9iYWwuY2hlc3MuaGlzdG9yeSgpXHJcblx0XHRcdGJhc2U2NCA9IGhleFRvQmFzZTY0KGNyeXB0b0pzLlNIQTI1NihmZW4pLnRvU3RyaW5nKCkpLnNsaWNlIDAsOFxyXG5cdFx0XHR2YWx1ZSA9IGdsb2JhbC5kYXRhYmFzZVtiYXNlNjRdIG9yIFwiP1wiXHJcblx0XHRcdCMgY29uc29sZS5sb2cga2V5LCBzYW4sIGJhc2U2NCwgdmFsdWUsIGZlblxyXG5cdFx0XHR0ZXh0IHNhbisgXCI6IFwiICsgdmFsdWUsIDguNypTSVpFLCAxKlNJWkUgKyBpKjAuNSpTSVpFXHJcblx0XHRcdGdsb2JhbC5jaGVzcy51bmRvKClcclxuXHRcdHBvcCgpXHJcblxyXG5cdGRyYXcgOiA9PlxyXG5cclxuXHRcdGZvciBidXR0b24gaW4gQGJ1dHRvbnNcclxuXHRcdFx0YnV0dG9uLmRyYXcoKVxyXG5cclxuXHRcdGlmIG5vdCBnbG9iYWwudHJlZSB0aGVuIHJldHVyblxyXG5cclxuXHRcdGZpbGwgJ3doaXRlJ1xyXG5cdFx0dGV4dFNpemUgU0laRSowLjNcclxuXHJcblx0XHRwdXNoKClcclxuXHRcdHRleHRBbGlnbiBMRUZULENFTlRFUlxyXG5cdFx0dGV4dCBnbG9iYWwudHJlZXNbMF0ubmFtZSwwLjA1KlNJWkUsIDAuMypTSVpFXHJcblx0XHRwb3AoKVxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgOFxyXG5cdFx0XHRcdHBpZWNlID0gZ2xvYmFsLmNoZXNzLmJvYXJkKClbNy1pXVtqXSAjIHtzcXVhcmUsIHR5cGUsIGNvbG9yfVxyXG5cdFx0XHRcdEBzcXVhcmVzW2kqOCtqXS5kcmF3IHBpZWNlLCBAZmxpcHBlZCwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1swXVxyXG5cclxuXHRcdHN0cm9rZSAnYmxhY2snXHJcblx0XHRub0ZpbGwoKVxyXG5cdFx0cmVjdCBTSVpFKjQuNSxTSVpFKjQuNSxTSVpFKjgsU0laRSo4XHJcblxyXG5cdFx0QGxpdHRlcmEoKVxyXG5cclxuXHRcdHB1c2goKVxyXG5cdFx0dGV4dEFsaWduIENFTlRFUixDRU5URVJcclxuXHRcdGlmIGdsb2JhbC5pbmRleCA+IDBcclxuXHRcdFx0dGV4dCAnbW92ZTogJyArICgxK2dsb2JhbC5pbmRleC8vMikgKyBcIkJXXCJbZ2xvYmFsLmluZGV4JTJdKyBcIiBvZiBcIisgKDErZ2xvYmFsLm1vdmVzLmxlbmd0aC8vMiksIDQuNSpTSVpFLCAxMCpTSVpFXHJcblx0XHRpZiBnbG9iYWwuaW5kZXg9PTBcclxuXHRcdFx0c2NvcmUgPSAnMCdcclxuXHJcblx0XHR0ZXh0IGdsb2JhbC52ZXJzaW9uLCA3LjUqU0laRSwgMTAqU0laRVxyXG5cdFx0dGV4dEFsaWduIFJJR0hULENFTlRFUlxyXG5cdFx0ZmlsbCAnd2hpdGUnXHJcblx0XHR0ZXh0IHNjb3JlLCAxMC4xKlNJWkUsIDAuMypTSVpFXHJcblxyXG5cdFx0cG9wKClcclxuXHRcdEBkcmF3QmFycyBzY29yZVxyXG5cdFx0QHNob3dDaGlsZHJlbigpXHJcblxyXG5cdGxpdHRlcmEgOiA9PlxyXG5cdFx0bm9TdHJva2UoKVxyXG5cdFx0ZmlsbCAnYmxhY2snXHJcblx0XHR0ZXh0U2l6ZSBTSVpFKjAuM1xyXG5cdFx0bGV0dGVycyA9IGlmIEBmbGlwcGVkIHRoZW4gXCJoZ2ZlZGNiYVwiIGVsc2UgXCJhYmNkZWZnaFwiXHJcblx0XHRkaWdpdHMgPSBpZiBAZmxpcHBlZCB0aGVuICBcIjEyMzQ1Njc4XCIgZWxzZSBcIjg3NjU0MzIxXCJcclxuXHJcblx0XHRmb3IgaSBpbiByYW5nZSA4XHJcblx0XHRcdHRleHQgbGV0dGVyc1tpXSxTSVpFKihpKzEpLFNJWkUqOC44XHJcblx0XHRcdHRleHQgZGlnaXRzW2ldLFNJWkUqMC4xNSxTSVpFKihpKzEpXHJcblxyXG5cdGZsaXAgOiA9PiBAZmxpcHBlZCA9IG5vdCBAZmxpcHBlZFxyXG5cclxuXHRkcmF3QmFycyA6IChzY29yZSkgLT5cclxuXHRcdHBhcmFtLlN0cmluZyBzY29yZVxyXG5cdFx0c3Ryb2tlICdibGFjaycgXHJcblx0XHRoID0gY2FsY0JhciBzY29yZVxyXG5cdFx0cHVzaCgpXHJcblx0XHRpZiBAZmxpcHBlZFxyXG5cdFx0XHR0cmFuc2xhdGUgMCwgU0laRSo5XHJcblx0XHRcdHNjYWxlIDEsIC0xXHJcblx0XHRyZWN0TW9kZSBDT1JORVJcclxuXHRcdG5vU3Ryb2tlKClcclxuXHRcdHggPSAwLjM1ICogU0laRVxyXG5cdFx0dyA9IDAuMTAgKiBTSVpFXHJcblx0XHRmaWxsICdibGFjaydcclxuXHRcdHJlY3QgeCwgMC41KlNJWkUsIHcsIFNJWkUgKiA0XHJcblx0XHRmaWxsICd3aGl0ZSdcclxuXHRcdHJlY3QgeCwgNC41KlNJWkUsIHcsIFNJWkUgKiA0XHJcblx0XHRpZiBoID4gMFxyXG5cdFx0XHRmaWxsICd3aGl0ZSdcclxuXHRcdFx0cmVjdCB4LCA0LjUqU0laRSAtIGgsIHcsIGhcclxuXHRcdGVsc2VcclxuXHRcdFx0ZmlsbCAnYmxhY2snXHJcblx0XHRcdHJlY3QgeCwgNC41KlNJWkUsIHcsIC1oXHJcblx0XHRwb3AoKVxyXG5cclxuXHRjYWxjQmFyID0gKHNjb3JlKSA9PlxyXG5cdFx0cGFyYW0uU3RyaW5nIHNjb3JlXHJcblx0XHRMSU1JVCA9IDIwMDBcclxuXHRcdGlmIHNjb3JlWzBdPT0nIycgdGhlbiBkID0gTElNSVRcclxuXHRcdGVsc2UgZCA9IE1hdGguYWJzIHNjb3JlXHJcblx0XHRpZiBkPkxJTUlUIHRoZW4gZCA9IExJTUlUXHJcblx0XHRyZXMgPSBsZXJwIDAsIDQqU0laRSwgZC9MSU1JVFxyXG5cdFx0aWYgXCItXCIgaW4gc2NvcmUgdGhlbiByZXMgPSAtcmVzXHJcblx0XHRwYXJhbS5JbnRlZ2VyIE1hdGgucm91bmQgcmVzXHJcblx0YXNzIDQqU0laRSxjYWxjQmFyIFwiMjEwMFwiXHJcblx0YXNzIDQqU0laRSxjYWxjQmFyIFwiMjAwMFwiXHJcblx0YXNzIDIqU0laRSxjYWxjQmFyIFwiMTAwMFwiXHJcblx0YXNzIFNJWkUsY2FsY0JhciBcIjUwMFwiXHJcblx0YXNzIDAsY2FsY0JhciBcIjFcIlxyXG5cdGFzcyAtU0laRSxjYWxjQmFyIFwiLTUwMFwiXHJcblx0YXNzIC00KlNJWkUsY2FsY0JhciBcIiMtMVwiXHJcbiJdfQ==
//# sourceURL=c:\github\2023-019-ChessTree\coffee\board.coffee